<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebAssembly Hesap Makinesi</title>
    <script src="calculator.js"></script>
</head>

<body>
    <h1>WebAssembly Hesap Makinesi</h1>
    <input id="num1" type="number" placeholder="Sayı 1">
    <input id="num2" type="number" placeholder="Sayı 2">
    <button onclick="calculate('add')">Topla</button>
    <button onclick="calculate('subtract')">Çıkar</button>
    <button onclick="calculate('multiply')">Çarp</button>
    <button onclick="calculate('divide')">Böl</button>
    <p id="result">Sonuç: </p>

    <script>
        let wasmInstance;

        // WebAssembly dosyasını yükleyelim
        fetch('calculator.wasm')
            .then(response => response.arrayBuffer())  // Dosyayı binary formatta alıyoruz
            .then(bytes => WebAssembly.instantiate(bytes))  // WebAssembly modülünü oluşturuyoruz
            .then(wasmModule => {
                wasmInstance = wasmModule.instance;
                const { add, subtract, multiply, divide } = wasmModule.instance.exports;

                window.calculate = function (operation) {
                    console.log(' wasmInstance.exports', wasmInstance.exports);
                    const num1 = parseInt(document.getElementById('num1').value);
                    const num2 = parseInt(document.getElementById('num2').value);
                    let result;

                    // Fonksiyonlar doğru şekilde alındı mı kontrol edelim
                    if (wasmInstance) {
                        if (operation === 'add' && add) {
                            result = add(num1, num2);
                        } else if (operation === 'subtract' && subtract) {
                            result = subtract(num1, num2);
                        } else if (operation === 'multiply' && multiply) {
                            result = multiply(num1, num2);
                        } else if (operation === 'divide' && divide) {
                            result = divide(num1, num2);
                        } else {
                            result = 'Fonksiyon bulunamadı.';
                        }
                    } else {
                        result = 'WebAssembly modülü yüklenmedi.';
                    }

                    document.getElementById('result').innerText = `Sonuç: ${result}`;
                };

            })
            .catch(console.error);



    </script>
</body>

</html>